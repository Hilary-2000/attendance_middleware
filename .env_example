# ═══════════════════════════════════════════════════════════════
#  Middleware Configuration – Hikvision ↔ Cloud School System
#  File: .env
# ───────────────────────────────────────────────────────────────
#  ⚠  IMPORTANT:
#     • Add .env to your .gitignore – never commit this file.
#     • Copy this file to .env.example (with dummy values) for
#       teammates who clone the repo.
# ═══════════════════════════════════════════════════════════════


# ───────────────────────────────────────────────────────────────
#  1. HIKVISION FACE TERMINAL
# ───────────────────────────────────────────────────────────────

# The name, model, or serial number used to identify THIS specific terminal
# during subnet scanning. Accepts: deviceName, model, or serialNumber (case-insensitive).
# Examples:  DS-K1T342MFX-E1   |   GL0274831   |   Entrance Terminal
TERMINAL_DEVICE_NAME=GL0274831

# IP address or hostname of the terminal on the local network
TERMINAL_HOST=192.168.86.11

# HTTP port (default 80) or HTTPS port (default 443)
TERMINAL_PORT=80

# Admin credentials for ISAPI access
TERMINAL_USERNAME=admin
TERMINAL_PASSWORD=XXXXXXXX

# Set to "true" to use HTTPS when connecting to the terminal
TERMINAL_USE_HTTPS=false

# Set to "false" only in development when the terminal uses a
# self-signed certificate. Always "true" in production.
TERMINAL_REJECT_UNAUTHORIZED=false

# How many event records to fetch per ISAPI page (max 100)
TERMINAL_PAGE_SIZE=500

# Fetch all paginated results automatically ("true" / "false")
TERMINAL_FETCH_ALL_PAGES=true


# ───────────────────────────────────────────────────────────────
#  2. CLOUD SCHOOL SYSTEM API
# ───────────────────────────────────────────────────────────────

# Unique school identifier sent with every attendance payload
# Issued by your Cloud School System administrator
SCHOOL_CODE=35601110

# Base URL of your Cloud School System REST API
CLOUD_API_BASE_URL=http://192.168.86.18:81/sims/ajax/administration

# API key or Bearer token issued by the cloud platform
CLOUD_API_KEY=your-cloud-api-key-here

# Endpoint path to post attendance records to
CLOUD_ATTENDANCE_ENDPOINT=/online_attendance.php

# Timeout for cloud API calls in milliseconds
CLOUD_API_TIMEOUT_MS=5000

# Max number of records to send in a single batch POST
CLOUD_BATCH_SIZE=50

# Number of times to retry a failed cloud API call before giving up
CLOUD_RETRY_ATTEMPTS=3

# Delay in milliseconds between retry attempts
CLOUD_RETRY_DELAY_MS=2000


# ───────────────────────────────────────────────────────────────
#  3. SYNC SCHEDULER
# ───────────────────────────────────────────────────────────────

# Cron expression controlling how often attendance is pulled
# Default: every 5 minutes  →  "*/5 * * * *"
# Every minute              →  "* * * * *"
# Every hour                →  "0 * * * *"
SYNC_CRON_SCHEDULE=*/5 * * * *

# Timezone for the cron scheduler and log timestamps
SYNC_TIMEZONE=Africa/Nairobi

# How far back (in minutes) to look for events on each pull.
# Should be slightly longer than your cron interval to avoid gaps.
SYNC_LOOKBACK_MINUTES=10

# Attendance time-out boundary — events at or after HH:MM become time_out
# Default: 14:30 (2:30 PM). Adjust to match your school day.
TIMEOUT_HOUR=14
TIMEOUT_MINUTE=30


# ───────────────────────────────────────────────────────────────
#  4. LOCAL QUEUE / OFFLINE BUFFER
# ───────────────────────────────────────────────────────────────

# Path to the local file-based queue used when the cloud is unreachable
QUEUE_FILE_PATH=./data/queue.json

# Maximum number of records to hold in the offline queue before
# dropping the oldest entries (0 = unlimited)
QUEUE_MAX_SIZE=5000


# ───────────────────────────────────────────────────────────────
#  5. LOGGING
# ───────────────────────────────────────────────────────────────

# Log level: "error" | "warn" | "info" | "debug"
LOG_LEVEL=info

# Directory where log files are written
LOG_DIR=./logs

# Maximum size of a single log file before rotation (e.g. "10m", "1g")
LOG_MAX_SIZE=10m

# Number of rotated log files to keep
LOG_MAX_FILES=7


# ───────────────────────────────────────────────────────────────
#  6. MIDDLEWARE SERVER (optional – for a status/health endpoint)
# ───────────────────────────────────────────────────────────────

# Port the Express health-check server listens on
SERVER_PORT=3000

# Set to "production" or "development"
NODE_ENV=development

# ───────────────────────────────────────────────────────────────
#  7. GITHUB AUTO-UPDATER
# ───────────────────────────────────────────────────────────────

# Your GitHub repository URL (used for reference — git remote handles the actual pull)
# Set this after running: git remote add origin
GITHUB_REPO_URL=https://github.com/Hilary-2000/attendance_middleware.git
GITHUB_BRANCH=main